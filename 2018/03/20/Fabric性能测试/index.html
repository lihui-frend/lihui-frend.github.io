<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Fabric性能测试 | 努力，奋斗</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Fabric性能测试</h1><a id="logo" href="/.">努力，奋斗</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 主页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Fabric性能测试</h1><div class="post-meta">Mar 20, 2018</div><div class="post-content"><p>Fabric性能测试</p>
<h4 id="目的："><a href="#目的：" class="headerlink" title="目的："></a>目的：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">验证fabric在并发请求（invoke、query）下的性能</span><br></pre></td></tr></table></figure>
<h4 id="环境："><a href="#环境：" class="headerlink" title="环境："></a>环境：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在centos7系统下搭建fabric，基于fabric v1.0.6版本，go version go1.9.2 linux/amd64，Docker version 18.01.0-ce, build 03596f5，docker-compose version 1.18.0, build 8dd22a9</span><br><span class="line">安装fabric所需环境，可以参考http://blog.csdn.net/btqszl/article/details/78182525</span><br></pre></td></tr></table></figure>
<h4 id="网络拓扑："><a href="#网络拓扑：" class="headerlink" title="网络拓扑："></a>网络拓扑：</h4><img src="/2018/03/20/Fabric性能测试/1.png">
<ol>
<li>基于fabric官方提供的e2e例子开启区块链网络</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli</span><br><span class="line"></span><br><span class="line">./network_setup.sh up</span><br></pre></td></tr></table></figure>
<p>开启网络后，见到下图表示网络开启成功<br><img src="/2018/03/20/Fabric性能测试/2.png"><br>docker ps -a<br><img src="/2018/03/20/Fabric性能测试/3.png"><br>网络中包含两个组织共4个peer节点，一个orderer排序节点，网络中已经安装$GOPATH/src/github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02/chaincode_example02.go智能合约，智能合约主要是一个转账操作，例如A转B多少资金</p>
<ol start="2">
<li><p>利用go web框架beego对fabric-go-sdk的invoke（修改）和query（查询）接口进行restful封装,然后开启go web服务，等待响应并发请求，见下图表示beego服务已经开启</p>
<img src="/2018/03/20/Fabric性能测试/4.png">
</li>
<li><p>采用压力测试工具ab对go web服务进行压力测试</p>
</li>
</ol>
<p>压测命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ab -c 1 -n 100 -p &quot;test.txt&quot; -T &quot;application/json&quot; &apos;http://localhost:2323/chaincode/invoke&apos;</span><br><span class="line"></span><br><span class="line">ab -c 1 -n 100 -p &quot;test.txt&quot; -T &quot;application/json&quot; &apos;http://localhost:2323/chaincode/query&apos;</span><br></pre></td></tr></table></figure>
<p>结果：<br><img src="/2018/03/20/Fabric性能测试/5.png"></p>
<p>fabric的invoke并发性能异常，怀疑是因为并发请求时，多次交易(A转账B)基于账本同一状态，当前面的交易提交到账本后，账本状态改变，导致后面的交易变为无效，所以修改智能合约，使得invoke操作变为插入操作(key-&gt;value),然后修改beego服务程序，使得invoke操作每次插入不同的key(自增)，再次对invoke和query接口进行压力测试</p>
<p>测试结果：</p>
<p>Invoke<br><br><img src="/2018/03/20/Fabric性能测试/7.png"></p>
<p>invoke在并发不超过330时，不会产生失败请求</p>
<p>Query<br><img src="/2018/03/20/Fabric性能测试/8.png"><br><img src="/2018/03/20/Fabric性能测试/9.png"></p>
<p>query在并发不超过500时，不会产生失败请求,和修改前测试结果一样</p>
<p> df -h   查看磁盘占用空间<br><img src="/2018/03/20/Fabric性能测试/10.png"><br><img src="/2018/03/20/Fabric性能测试/11.png"></p>
<p>发现是容器的log增长过快，修改docker compose启动文件, 关闭容器log问题解决<br><img src="/2018/03/20/Fabric性能测试/12.png">s</p>
</div><div class="tags"><a href="/tags/blockChain/">blockChain</a></div><div class="post-nav"><a class="next" href="/2018/02/21/搭建Redis集群哨兵模式/">搭建Redis集群哨兵模式</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/jvm/" style="font-size: 15px;">jvm</a> <a href="/tags/blockChain/" style="font-size: 15px;">blockChain</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/spark/" style="font-size: 15px;">spark</a> <a href="/tags/sql/" style="font-size: 15px;">sql</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/03/20/Fabric性能测试/">Fabric性能测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/21/搭建Redis集群哨兵模式/">搭建Redis集群哨兵模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/15/Spark-Streaming性能优化/">Spark Streaming性能优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/12/Spark学习笔记/">Spark学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/03/Spring-声明式事务管理/">Spring-声明式事务管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/10/乐观锁与悲观锁原理/">乐观锁与悲观锁原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/02/sql优化/">sql优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/25/AOP技术/">AOP技术-读书笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/21/Spring框架（IOC和DI）/">Spring框架（IOC和DI）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/28/Java反射机制/">Java反射机制</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 链接</i></div><ul></ul><a href="https://github.com/lihui-frend" title="Github" target="_blank">Github</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">努力，奋斗.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"></a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>